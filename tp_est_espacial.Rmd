---
title: "Trabajo práctico: estadística espacial"
author: "Mateo W. Racca"
date: "`r format(Sys.time(), '%d/%m/%y')`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: sandstone
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introducción


Este trabajo forma parte del módulo Estadística Espacial en el posgrado en Big Data e Inteligencia Territorial de FLACSO Argentina a cargo de Priscilla Minotti.


Se abordará un data set sobre puntos de elevación de la ciudad de Nueva York con distintos métodos de interpolación espacial. El objetivo es mostrar las diferencias, fortalezas y debilidades de cada uno.


Los datos originales están disponibles [acá](https://data.cityofnewyork.us/api/geospatial/szwg-xci6?method=export&format=Shapefile) mientras que la muestra con la que trabajamos junto con el proyecto del trabajo [acá](https://github.com/raccamateo/interpolacion_espacial).



## Paquetes


Cargamos los paquetes que vamos a utilizar:


```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(sf)
library(sp)
library(rgdal)
library(raster)
library(gstat)
library(osmdata)
library(leaflet)
library(tmap)
```


# Ahora sí: a los datos


Vamos a explicar paso por paso cómo es el procedimiento desde la carga de datos al procesamiento, las visualizaciones, los métodos de interpolación en sí y los resultados.


## Datos


Cargamos el data set con la muestra de los puntos de elevación que vamos a usar para interpolar.


```{r}
elevaciones <- st_read("elevaciones_NY_muestra.shp") %>%
  st_as_sf() 
```


Para graficar los puntos en el mapa vamos a usar **tmap**. Lo configuramos.


```{r, message=FALSE}
tmap_mode("view")
```


Y ahora, graficamos los puntos con el mapa base:


```{r}
qtm(elevaciones)
```


Ahora vamos a ver específicamente cómo de distribuyen los puntos de elevación de nuestro data set y cual es su altura:


```{r}
ggplot() + geom_sf(data = elevaciones, aes(color = ELEVATION)) + scale_color_viridis_c(name = "[Altura]")+ theme_bw()
```


## Límites y Áreas de Interés


En este apartado vamos a ver tres métodos para definir el área de trabajo o de interés (AOI) que nos resulta útil para definir el área de análisis espacial a partir de nuestros datos.


### Bounding box (bbox)


Bounding box (o simplemente bbox) es un área definida por dos latitudes y dos longitudes.En este caso, usamos bbox que nos sirve para setear los límites (en forma de caja).


```{r}
elevaciones_bbox <- st_as_sfc(st_bbox(elevaciones))
```


### Buffer


Cuando usamos la función st_buffer(), ésta nos devuelve una geometría que representa todos los puntos cuya distancia es menor o igual a la distancia indicada. En este caso vamos a usar como distancia 10500 metros para crear un polígono usable para interpolar.


```{r}
elevaciones_buffer <- elevaciones %>% st_buffer(dist= 10500) %>% st_geometry() %>% st_union()
elevaciones_buffer
```


### Polígono máximo convexo o convex hull


Convex hull es el polígono convexo más pequeño que incluye a todos los puntos incluidos en un data set. Vamos a calcular el polígono máximo convexo de nuestros puntos de elevación:


```{r}
elevaciones_convex_hull <- elevaciones %>% st_union()%>% st_convex_hull()
elevaciones_convex_hull
```


Ahora vamos a ver cada tipo de límite en el mapa:
